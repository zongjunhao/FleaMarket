<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>二手交易平台</title>
    <!-- VENDOR CSS -->
    <link rel="stylesheet" href="/assets/vendor/bootstrap/css/bootstrap.min.css">
    <!--    <link rel="stylesheet" href="/assets/vendor/font-awesome/css/font-awesome.min.css">-->
    <!--    <link rel="stylesheet" href="/assets/vendor/linearicons/style.css">-->
    <!--    <link rel="stylesheet" href="/assets/vendor/chartist/css/chartist-custom.css">-->
    <!-- 引用阿里的字体图标库 -->
    <link rel="stylesheet" type="text/css" href="http://at.alicdn.com/t/font_1531354_qo2q2k7wq7.css">
    <!-- MAIN CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/demo.css">
</head>

<body>
<!-- WRAPPER -->
<div id="wrapper">
    <!-- NAVBAR -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="brand" style="padding: 20px">
                <span class="iconClass">
                    <div class="media-left">
                        <span class="iconfont iconershou" style="font-size: 2em"></span>
                    </div>
                    <div class="media-left">
                        <h4 class="media-heading">校园二手交易平台</h4>
                    </div>
                </span>
        </div>
        <div class="container-fluid">
            <div class="navbar-btn">
                <button type="button" class="btn-toggle-fullwidth">
                    <span class="iconfont iconiconleft"></span>
                </button>
            </div>
            <div class="navbar-form navbar-left">
                <div class="input-group">
                    <input id="search-input" type="text" value="" class="form-control" placeholder="查询商品">
                    <span class="input-group-btn">
                        <a href="goods/viewGoods.html" target="main" id="search-btn" type="button"
                           class="btn btn-primary">搜索</a>
                    </span>
                </div>
            </div>
            <ul class="nav navbar-nav navbar-right">
                <li id="mamageRole" data-toggle="tooltip" data-placement="left" title="管理员">
                    <a id="name" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                        <span class="iconfont icon-icon_xinyong_xianxing_jijin-"></span>
                        <span id="username">用户名</span>
                        <small><span class="iconfont iconarrow-down" style="font-size: 13px"></span></small>
                    </a>
                    <ul class="book-dropmenu dropdown-menu" aria-labelledby="dropdownMenu4">
                        <li>
                            <a target="main" class="userInfo">
                                <span class="iconfont iconiconcopy"> 个人信息</span>
                            </a>
                        </li>
                        <li>
                            <a class="changeInfo" target="main">
                                <span class="iconfont iconxiugaixinxi"> 修改信息</span>
                            </a>
                        </li>
                    </ul>
                </li>
                <li id="logout">
                    <a>
                        退出
                        <span class="iconfont icontuichu"></span>
                    </a>
                </li>
            </ul>
        </div>
    </nav>
    <!-- END NAVBAR -->
    <!-- LEFT SIDEBAR -->
    <div id="sidebar-nav" class="sidebar">
        <div class="sidebar-scroll">
            <nav>
                <ul class="nav adminNav">
                    <li>
                        <a href="/pages/admin/adminMainPage.html" target="main" class="active">
                            <span class="iconfont iconzhuye navleft">首页</span>
                        </a>
                    </li>
                    <li>
                        <a href="/pages/admin/userManage.html" target="main">
                            <span class="iconfont iconyonghuguanli navleft">用户管理</span>
                        </a>
                    </li>
                    <li>
                        <a href="/pages/admin/goodsManage.html" target="main">
                            <span class="iconfont iconviewlist navleft">商品管理</span>
                        </a>
                    </li>
                    <li>
                        <a href="/pages/admin/systemInfo.html" target="main">
                            <span class="iconfont iconxitongxinxi navleft">系统信息</span>
                        </a>
                    </li>
                </ul>
                <ul class="nav userNav">
                    <li>
                        <a href="/pages/user/userMainPage.html" target="main" class="active">
                            <span class="iconfont iconzhuye navleft">首页</span>
                        </a>
                    </li>
                    <li>
                        <a href="#subPages" data-toggle="collapse" class="collapsed">
                            <span class="iconfont iconshangpinleibie navleft">商品类别</span>
                            <span class="iconfont myarrow iconarrow-left navbar-right"></span>
                        </a>
                        <div id="subPages" class="collapse ">
                            <ul class="nav">
                                <li>
                                    <a href="/pages/goods/viewGoods.html" target="main" onclick="setCategoryID(0)">
                                        <span class="iconfont iconappzuixinfabu navleft secondary-text">最新发布</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="/pages/goods/viewGoods.html" target="main" onclick="setCategoryID(1)">
                                        <span class="iconfont iconshuma1 navleft">闲置数码</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="/pages/goods/viewGoods.html" target="main" onclick="setCategoryID(2)">
                                        <span class="iconfont iconjiaotongdanchezihangcheqihangxianxing navleft">校园代步</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="/pages/goods/viewGoods.html" target="main" onclick="setCategoryID(3)">
                                        <span class="iconfont icondianqi navleft">电器日用</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="/pages/goods/viewGoods.html" target="main" onclick="setCategoryID(4)">
                                        <span class="iconfont icontushu navleft">图书教材</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="/pages/goods/viewGoods.html" target="main" onclick="setCategoryID(5)">
                                        <span class="iconfont iconmeizhuang navleft">美妆衣物</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="/pages/goods/viewGoods.html" target="main" onclick="setCategoryID(6)">
                                        <span class="iconfont icon19 navleft">运动棋牌</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="/pages/goods/viewGoods.html" target="main" onclick="setCategoryID(7)">
                                        <span class="iconfont iconpiaoquan1 navleft">票券小物</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="/pages/goods/viewGoods.html" target="main" onclick="setCategoryID('myGoods')">
                            <span class="iconfont iconwofabude navleft">我发布的</span>
                        </a>
                    </li>
                    <li>
                        <a href="/pages/goods/viewGoods.html" target="main" onclick="setCategoryID('myCollection')">
                            <span class="iconfont iconwodeguanzhu navleft">我关注的</span>
                        </a>
                    </li>
                    <li>
                        <a href="/pages/goods/addNewGoods.html" target="main">
                            <span class="iconfont iconwoyaofabu navleft">我要发布</span>
                        </a>
                    </li>
                    <li>
                        <a href="/pages/goods/notice.html" target="main">
                            <span class="iconfont icon-qiugou navleft">求购信息</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
    <!-- END LEFT SIDEBAR -->
    <!-- MAIN -->
    <div class="main" id="main-content">
        <!-- MAIN CONTENT -->
        <div class="main-content">
            <div class="container-fluid">
                <!--                <div class="embed-responsive embed-responsive-16by9">-->
                <iframe name="main" src="/pages/admin/adminMainPage.html" width="100%" height="100%"
                        id="myiframe" class="embed-responsive-item" frameborder="0"></iframe>
                <!--                </div>-->
            </div>
        </div>
        <!-- END MAIN CONTENT -->
    </div>
    <!-- END MAIN -->
</div>
<!-- END WRAPPER -->
<!-- Javascript -->
<script src="/assets/vendor/jquery/jquery.min.js"></script>
<script src="/lib/jq/jquerySession.js"></script>
<script src="/assets/vendor/bootstrap/js/bootstrap.min.js"></script>
<script src="/assets/vendor/jquery-slimscroll/jquery.slimscroll.min.js"></script>
<script src="/assets/scripts/klorofil-common.js"></script>
<script src="../lib/js/vue.js"></script>
<!-- 添加导航栏的插件库 -->
<script type="text/javascript" src="../lib/js/navbar.js"></script>
<script type="text/javascript">
    var logout = [["/admin/logout", "a_account", "/pages/login.html"], ["/user/logout", "u_stuid", "/pages/login.html"]];
    var role = $.session.get("role");
    var url, id;

    $(document).ready(function () {
        $("#myiframe").height($(".slimScrollDiv").height() - 30);
    });

    // 左侧导航栏选择效果
    $(".sidebar-scroll .nav li a").click(function () {
        // console.log("click!!!!!!!!!!!!!!!!!")
        // 先去掉active类
        $(".sidebar-scroll .nav li a").removeClass("active");
        $(this).addClass("active");
    });

    $(".collapsed").click(function () {
        console.log("clicked");
        if ($(".myarrow").hasClass("iconarrow-left")) {
            $(".myarrow").addClass("iconarrow-down").removeClass("iconarrow-left")
        } else if ($(".myarrow").hasClass("iconarrow-down")) {
            $(".myarrow").addClass("iconarrow-left").removeClass("iconarrow-down")
        }
    });

    // 控制收起或展开左侧导航栏的箭头的方向
    $(".btn-toggle-fullwidth span").click(function () {
        if ($(this).hasClass("iconiconleft")) {
            $(this).removeClass("iconiconleft");
            $(this).addClass("iconiconright");
        } else {
            $(this).removeClass("iconiconright");
            $(this).addClass("iconiconleft");
        }
    });

    $(function () {
        console.log("the first function");
        init();

        $('[data-toggle="tooltip"]').tooltip();
        // //加载导航插件
        // $('#main-menu').metisMenu();

        $("#logout").click(function () {
            console.log("logout11111");
            logOut()
        });
        console.log("the first function end");
    });

    // 初始化
    function init() {
        console.log("init function");
        if (role == "1") { // 管理员
            url = logout[0][0] + "?" + logout[0][1] + "=" + $.session.get("a_account");
            id = $.session.get("a_account");
            $("#manageRole").attr("title", "管理员");
            $(".userInfo").attr("href", "/pages/admin/adminInfo.html");
            $(".changeInfo").attr("href", "/pages/admin/adminChangeInfo.html");
            $("#username").text($.session.get("a_account"));
            $(".userNav").hide();
            $(".navbar-form").hide();
        } else { // 用户
            url = logout[1][0] + "?" + logout[1][1] + "=" + $.session.get("u_stuid");
            id = $.session.get("u_id");
            $("#manageRole").attr("title", "用户");
            $(".userInfo").attr("href", "/pages/user/userInfo.html");
            $(".changeInfo").attr("href", "/pages/user/userChangeInfo.html");
            $("#myiframe").attr("src", "/pages/user/userMainPage.html");
            $("#username").text($.session.get("u_name"));
            $(".adminNav").hide();
        }
    }

    // 退出登陆
    function logOut() {
        console.log("logout2222222");
        $.ajax({
            type: "GET",
            url: url,
            success: function (res) {
                //console.log(returnLocation)
                if (res.resultCode == "4004") {
                    $.session.clear();
                    location.href = "login.html";
                } else if (res.resultCode == "4005") {
                    //alert("退出登陆失败，用户未登录");
                    //$.session.clear();
                    location.href = "/pages/login.html";
                } else {
                    alert(res.resultCode);
                }
            },
            error: function (res) {
                alert("请求的页面有错");
            }
        });
    }

    function setCategoryID(categoryId) {
        $.session.set("categoryId", categoryId);
        console.log($.session.get("categoryId"))
    }

    $("#search-btn").click(function () {
        $.session.set("categoryId", "search");
        $.session.set("searchInfo", $("#search-input").val());
        console.log($.session.get("categoryId"));
        console.log($.session.get("searchInfo"));
    })
</script>
</body>

</html>