<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>二手交易平台后台管理</title>
    <!-- 添加bootstrap的css样式表 -->
    <link rel="stylesheet" type="text/css" href="/lib/css/bootstrap.css">
    <!-- 添加自定义css -->
    <link rel="stylesheet" type="text/css" href="/css/main.css">
    <!-- 添加JQ -->
    <script type="text/javascript" src="/lib/jq/jquery-3.4.1.js"></script>
    <script type="text/javascript" src="/lib/jq/jquerySession.js"></script>
    <!-- 添加bootstrap的库 -->
    <script type="text/javascript" src="/lib/js/bootstrap.js"></script>
    <!-- 添加导航栏的插件库 -->
    <script type="text/javascript" src="/lib/js/navbar.js"></script>
    <!-- 引用阿里的字体图标库 -->
    <link rel="stylesheet" type="text/css" href="http://at.alicdn.com/t/font_1531354_ide54z3tzno.css">
    <!-- 	监听页面窗口大小改变的插件 -->
    <script type="text/javascript" src="/lib/js/detect-element-resize.js"></script>
</head>
<body>
<!-- 顶部导航条-->
<nav id="book-top" class="navbar navbar-fixed-top header" role="navigation">
    <div class="container-fluid">
        <!--标题-->
        <div class="navbar-header">
            <div class="media">
                <div class="media-left">
                    <span class="iconfont iconershou"></span>
                </div>
                <div class="media-body">
                    <h4 class="media-heading">校园二手交易平台</h4>
                </div>
            </div>
        </div>

        <div class="collapse navbar-collapse">
            <div id="sideNav" class="nav navbar-nav navbar-left">
                <span class="iconfont iconmenu"></span>
            </div>
            <ul class="nav navbar-nav navbar-right">
                <li id="mamageRole" data-toggle="tooltip" data-placement="left" title="管理员">
                    <a id="name" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                        <span class="iconfont icon-icon_xinyong_xianxing_jijin-"></span>
                        用户名
                        <small><span class="iconfont icon-xiala"></span></small>
                    </a>
                    <ul class="book-dropmenu dropdown-menu" aria-labelledby="dropdownMenu4">
                        <li>
                            <a target="main" class="userInfo">
                                <span class="iconfont iconiconcopy">  个人信息</span>
                            </a>
                        </li>
                        <li>
                            <a class="changeInfo" target="main">
                                <span class="iconfont iconxiugaixinxi">  修改信息</span>
                            </a>
                        </li>
                    </ul>
                </li>
                <li id="logout">
                    <a>
                        退出
                        <span class="iconfont icontuichu"></span>
                    </a>
                </li>
            </ul>
        </div>
    </div>
</nav>
<!-- /顶部导航条 -->

<!-- 左侧导航条 -->
<div id="book-left">
    <nav class="navbar-default navbar-side" role="navigation">
        <div class="sidebar-collapse">
            <ul class="nav" id="main-menu">
                <li>
                    <a href="/test.html" target="main" class="selected">
                        <span class="iconfont iconzhuye">首页</span>
                    </a>
                </li>
                <li>
                    <a href="userManage.html" target="main">
                        <span class="iconfont iconyonghuguanli">用户管理</span>
                    </a>
                </li>
                <li>
                    <a href="goodsManage.html" target="main">
                        <span class="iconfont iconviewlist">商品管理</span>
                    </a>
                </li>
                <li>
                    <a href="systemInfo.html" target="main">
                        <span class="iconfont iconxitongxinxi">系统信息</span>
                    </a>
                </li>
            </ul>
        </div>
    </nav>
</div>
<!-- 左侧导航条 -->

<!-- 页面主内容 -->
<div id="book-main">
    <!--  导航条  -->
    <div class="page-header">
        <h1 class="page-header">首页</h1>
        <ol class="breadcrumb">
            <li><a href="#">首页</a></li>
            <li class="active">首页</li>
        </ol>
    </div>
    <!-- 页面主内容 -->
    <iframe name="main" src="/test.html" width="100%" id="myiframe" scrolling="no" frameborder="0"></iframe>

</div>
<!-- /页面主内容 -->
</body>
<script type="text/javascript">
    var interval = setInterval("checkSession()", 1000 * 60 * 30);
    var logout = ["/admin/logout", "a_account", "/test.html"]
    $(document).ready(function () {
        //监听子页面大小变化，设置父页面的iframe的大小
        console.log("index");
        addResizeListener(document.getElementsByTagName("body")[0], function () {
            console.log("index body change");
            console.log("iframe", $("#myiframe").height());
            if ($("#myiframe").height() < 355) {
                document.getElementById("myiframe").height = "355";
                //$("#myiframe").css({"height":"355px"})//height(355);
                console.log($("#myiframe").height())
            } else {
            }
        });
    });

    $(function () {
        //初始化，设置退出时的url和退出时的地址
        init();
        //每隔半个小时判断session有没有失效，如果失效则要求用户重新登陆
        checkSession();

        $('[data-toggle="tooltip"]').tooltip();
        //加载导航插件
        $('#main-menu').metisMenu();

        //添加手气左侧导航栏功能
        $("#sideNav").click(function () {
            if ($(this).hasClass('closed')) {
                $('.navbar-side').animate({left: '0px'});
                $(this).removeClass('closed');
                $('#book-main').animate({'margin-left': '260px'});
            } else {
                $(this).addClass('closed');
                $('.navbar-side').animate({left: '-260px'});
                $('#book-main').animate({'margin-left': '0px'});
            }
        });

        var head = $("#book-main .header .breadcrumb");
        //给上方导航栏添加跳转信息
        $(".book-dropmenu a").click(function () {
            $("#book-main .header h1").text($(this).text());
            head.html("<li><a>首页</a></li>");
            head.append("<li><a href=''>个人中心</a></li>");
            head.append("<li class='active'>" + $(this).text() + "</li>");
        });

        //添加左侧导航栏的选择效果
        $("#book-left .navbar-side ul li a").click(function () {
            //先去掉selected类
            $("#book-left .navbar-side ul li a").removeClass("selected");
            //再给选择的导航栏添加特效
            //console.log($("#book-left .navbar-side ul li a"))
            head.html("<li><a>首页</a></li>");
            $("#book-main .header h1").text($(this).text());
            if ($(this).attr("level") == "1") {
                head.append("<li class='active'>" + $(this).text() + "</li>")
            } else {
                head.append("<li><a href=''>" + $(this).parents("li").eq(1).children("a").text() + "</a></li>");
                head.append("<li class='active'>" + $(this).text() + "</li>")
            }
            console.log($(this).attr("level"));
            $(this).addClass("selected")

        })

        $("#logout").click(function () {
            logOut()
        })

    });

    function init() {
        $("#book-left .navbar-side ul .l0").hide();

        url = logout[0] + "?" + logout[1] + "&" + $.session.get("a_account");
        $("#manageRole").attr("title", "系统管理员");
        $("#myiframe").attr("src", "adminMainPage.html");
        $("#book-left .navbar-side ul .l1").show();
        $("#name").text($.session.get("a_account"));
        $(".userInfo").attr("href", "adminInfo.html");
        $(".changeInfo").attr("href", "adminChangeInfo.html");
    }

    function logOut() {
        console.log("logout");
        $.ajax({
            type: "GET",
            url: url,
            success: function (res) {
                if (res.resultCode == "4004") {
                    $.session.clear();
                    location.href = "/login.html";
                } else if (res.resultCode == "4005") {
                    location.href = "/login,html"
                } else {
                    alert(res.resultCode)
                }
            },
            error: function (res) {
                alert("请求的页面有错");
            }
        });
    }

    // 检查session信息，失效了要求重新登录
    function checkSession() {
        console.log("id", id);
        if (id == null) {
            alert("请先登录！");
            location.href = "/login.html";
        }
    }
</script>
</html>